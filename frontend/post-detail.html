<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net; connect-src 'self' https://cdn.jsdelivr.net;">
<title>ê²Œì‹œê¸€ ìƒì„¸ - ìƒŒë“œìœ„ì¹˜ëƒ ëƒ </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
body {
  background-color: #f8f9fa;
  margin: 0;
  padding: 0;
}

.main-container {
  display: flex;
  min-height: 100vh;
}

/* ì¢Œì¸¡ LNB (Left Navigation Bar) */
.lnb {
  position: fixed;
  left: 0;
  top: 0;
  height: 100vh;
  width: 80px;
  background-color: #ffffff;
  border-right: 1px solid #e9ecef;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem 0;
  gap: 1.5rem;
  z-index: 100;
}

.lnb-button {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  background-color: #ffe0e6;
  color: #333;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.lnb-button:hover {
  background-color: #ffd1dc;
  transform: scale(1.05);
}

.lnb-button.active {
  background-color: #ffb3c1;
}

/* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
.main-content {
  margin-left: 80px;
  flex: 1;
  padding: 2rem;
}

/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
.back-button {
  margin-bottom: 1.5rem;
  background: none;
  border: none;
  color: #6c757d;
  font-size: 1rem;
  cursor: pointer;
  padding: 0.5rem 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: color 0.2s;
}

.back-button:hover {
  color: #333;
}

/* ê²Œì‹œê¸€ ìƒì„¸ ì»¨í…Œì´ë„ˆ */
.detail-container {
  background-color: #ffffff;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

/* ì¹´í…Œê³ ë¦¬ */
.post-category {
  display: inline-block;
  padding: 0.4rem 1rem;
  border-radius: 20px;
  background-color: #ffe0e6;
  color: #ff6b9d;
  font-size: 0.9rem;
  font-weight: 500;
  margin-bottom: 1rem;
}

/* ì œëª© */
.post-title {
  font-size: 2rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 1.5rem;
  line-height: 1.4;
}

/* ë©”íƒ€ ì •ë³´ (ì‘ì„±ì, ì‘ì„±ì¼, ì¡°íšŒìˆ˜) */
.post-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid #e9ecef;
  margin-bottom: 2rem;
  flex-wrap: wrap;
}

.author-info {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.author-profile {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #9ab7cb;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 1rem;
}

.author-name {
  font-size: 1rem;
  color: #333;
  font-weight: 500;
}

.meta-divider {
  color: #dee2e6;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #6c757d;
  font-size: 0.9rem;
}

.meta-item-icon {
  font-size: 1rem;
}

/* ë³¸ë¬¸ ë‚´ìš© */
.post-content {
  font-size: 1rem;
  line-height: 1.8;
  color: #333;
  margin-bottom: 2rem;
  min-height: 200px;
}

.post-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 1rem 0;
}

.post-content iframe {
  max-width: 100%;
  border-radius: 8px;
  margin: 1rem 0;
}

/* íƒœê·¸ ì„¹ì…˜ */
.post-tags {
  padding-top: 1.5rem;
  border-top: 1px solid #e9ecef;
}

.tags-label {
  font-size: 0.9rem;
  color: #6c757d;
  margin-bottom: 0.75rem;
  font-weight: 500;
}

.tag-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.tag-badge {
  display: inline-block;
  padding: 0.4rem 0.8rem;
  background-color: #f0f0f0;
  color: #333;
  border-radius: 20px;
  font-size: 0.85rem;
}

/* ì´ë¯¸ì§€ ì„¹ì…˜ (ë ˆì‹œí”¼ìš©) */
.post-image-section {
  margin-bottom: 2rem;
  text-align: center;
}

.post-image {
  max-width: 100%;
  max-height: 500px;
  border-radius: 12px;
  object-fit: contain;
}

/* ë¡œë”© ë° ì—ëŸ¬ */
.loading {
  text-align: center;
  padding: 3rem;
  color: #6c757d;
}

.error {
  text-align: center;
  padding: 3rem;
  color: #dc3545;
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
  .lnb {
    width: 60px;
    padding: 1rem 0;
  }

  .lnb-button {
    width: 44px;
    height: 44px;
    font-size: 1.2rem;
  }

  .main-content {
    margin-left: 60px;
    padding: 1rem;
  }

  .detail-container {
    padding: 1.5rem;
  }

  .post-title {
    font-size: 1.5rem;
  }

  .post-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .meta-divider {
    display: none;
  }
}

@media (max-width: 480px) {
  .post-title {
    font-size: 1.25rem;
  }

  .author-profile {
    width: 32px;
    height: 32px;
    font-size: 0.85rem;
  }
}
</style>
</head>
<body>
<div class="main-container">
  <!-- ì¢Œì¸¡ LNB -->
  <nav class="lnb">
    <button class="lnb-button" id="recipeBtn" title="ì´ë ‡ê²Œ ë§Œë“¤ì–´ìš”" onclick="window.location.href='/board.html?board=1'">
      ğŸ¥ª
    </button>
    <button class="lnb-button" id="tipBtn" title="ì •ë³´ ê³µìœ í•´ìš”" onclick="window.location.href='/board.html?board=2'">
      ğŸ’¡
    </button>
  </nav>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <main class="main-content">
    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <button class="back-button" onclick="window.history.back()">
      <span>â†</span>
      <span>ëª©ë¡ìœ¼ë¡œ</span>
    </button>

    <!-- ê²Œì‹œê¸€ ìƒì„¸ ì»¨í…Œì´ë„ˆ -->
    <div class="detail-container" id="detailContainer">
      <div class="loading" id="loading">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      <div class="error" id="error" style="display: none;"></div>
      
      <!-- ê²Œì‹œê¸€ ë‚´ìš© (ë™ì ìœ¼ë¡œ ìƒì„±) -->
      <div id="postContent" style="display: none;">
        <div class="post-category" id="postCategory"></div>
        <div class="post-image-section" id="postImageSection" style="display: none;">
          <img class="post-image" id="postImage" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€">
        </div>
        <h1 class="post-title" id="postTitle"></h1>
        <div class="post-meta">
          <div class="author-info">
            <div class="author-profile" id="authorProfile"></div>
            <span class="author-name" id="authorName"></span>
          </div>
          <span class="meta-divider">|</span>
          <div class="meta-item">
            <span class="meta-item-icon">ğŸ“…</span>
            <span id="postDate"></span>
          </div>
          <span class="meta-divider">|</span>
          <div class="meta-item">
            <span class="meta-item-icon">ğŸ‘ï¸</span>
            <span id="postViews"></span>
          </div>
        </div>
        <div class="post-content" id="postContentBody"></div>
        <div class="post-tags" id="postTagsSection" style="display: none;">
          <div class="tags-label">íƒœê·¸</div>
          <div class="tag-list" id="tagList"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div id="site-footer" class="mt-5"></div>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
// URL íŒŒë¼ë¯¸í„°ì—ì„œ typeê³¼ id ê°€ì ¸ì˜¤ê¸°
const urlParams = new URLSearchParams(window.location.search);
const postType = urlParams.get('type'); // 'recipe' or 'tip'
const postId = urlParams.get('id');

// DOM ìš”ì†Œ
const loading = document.getElementById('loading');
const error = document.getElementById('error');
const postContent = document.getElementById('postContent');
const detailContainer = document.getElementById('detailContainer');

// ê²Œì‹œê¸€ ë¡œë“œ
async function loadPost() {
  if (!postType || !postId) {
    showError('ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.');
    return;
  }

  try {
    const apiUrl = postType === 'recipe' 
      ? `/api/recipes/${postId}`
      : `/api/tips/${postId}`;
    
    const response = await fetch(apiUrl);
    const result = await response.json();

    if (!result.success) {
      showError(result.message || 'ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    const data = result.data;
    console.log('ê²Œì‹œê¸€ ë°ì´í„° ì „ì²´:', data); // ë””ë²„ê¹…ìš©
    console.log('ê²Œì‹œê¸€ ë°ì´í„° í‚¤ ëª©ë¡:', Object.keys(data)); // ë””ë²„ê¹…ìš©
    console.log('CONTENT ê°’:', data.CONTENT); // ë””ë²„ê¹…ìš©
    console.log('CONTENT íƒ€ì…:', typeof data.CONTENT); // ë””ë²„ê¹…ìš©
    console.log('CONTENT ì¡´ì¬ ì—¬ë¶€:', data.CONTENT !== null && data.CONTENT !== undefined); // ë””ë²„ê¹…ìš©
    
    // ëª¨ë“  í‚¤ë¥¼ í™•ì¸í•˜ì—¬ CONTENTì™€ ìœ ì‚¬í•œ í‚¤ ì°¾ê¸°
    const contentKeys = Object.keys(data).filter(key => key.toLowerCase().includes('content'));
    console.log('CONTENT ê´€ë ¨ í‚¤ë“¤:', contentKeys); // ë””ë²„ê¹…ìš©
    
    displayPost(data);
  } catch (err) {
    console.error('ê²Œì‹œê¸€ ë¡œë“œ ì˜¤ë¥˜:', err);
    showError('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}

// ê²Œì‹œê¸€ í‘œì‹œ
function displayPost(data) {
  // ì¹´í…Œê³ ë¦¬
  const categoryEl = document.getElementById('postCategory');
  if (data.CATEGORY_NAME) {
    categoryEl.textContent = data.CATEGORY_NAME;
    categoryEl.style.display = 'inline-block';
  } else {
    categoryEl.style.display = 'none';
  }

  // ì´ë¯¸ì§€ (ë ˆì‹œí”¼ë§Œ)
  if (postType === 'recipe' && data.IMAGE_URL) {
    const imageSection = document.getElementById('postImageSection');
    const imageEl = document.getElementById('postImage');
    imageEl.src = data.IMAGE_URL;
    imageEl.onerror = function() {
      imageSection.style.display = 'none';
    };
    imageSection.style.display = 'block';
  } else {
    document.getElementById('postImageSection').style.display = 'none';
  }

  // ì œëª©
  document.getElementById('postTitle').textContent = data.TITLE || 'ì œëª© ì—†ìŒ';

  // ì‘ì„±ì í”„ë¡œí•„ ì•„ì´ì½˜ (ì´ë¦„ì˜ ì²« ê¸€ì)
  const authorName = data.AUTHOR_NAME || 'ìµëª…';
  const authorProfile = document.getElementById('authorProfile');
  authorProfile.textContent = authorName.charAt(0).toUpperCase();
  document.getElementById('authorName').textContent = authorName;

  // ì‘ì„±ì¼
  const createdAt = data.CREATED_AT_FORMATTED || 
    new Date(data.CREATED_AT).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    }).replace(/\. /g, '.').replace(/\.$/, '');
  document.getElementById('postDate').textContent = createdAt;

  // ì¡°íšŒìˆ˜
  const views = data.VIEWS ? data.VIEWS.toLocaleString() : '0';
  document.getElementById('postViews').textContent = views;

  // ë³¸ë¬¸ ë‚´ìš©
  const contentBody = document.getElementById('postContentBody');
  
  // CONTENT ì»¬ëŸ¼ ì°¾ê¸° (ëª¨ë“  ê°€ëŠ¥í•œ í‚¤ ì‹œë„)
  let content = null;
  if (data.CONTENT !== null && data.CONTENT !== undefined) {
    content = data.CONTENT;
  } else if (data.content !== null && data.content !== undefined) {
    content = data.content;
  } else if (data.Content !== null && data.Content !== undefined) {
    content = data.Content;
  } else {
    // ëª¨ë“  í‚¤ë¥¼ í™•ì¸í•˜ì—¬ CONTENTì™€ ìœ ì‚¬í•œ í‚¤ ì°¾ê¸°
    const contentKey = Object.keys(data).find(key => 
      key.toLowerCase() === 'content' || 
      key.toLowerCase().includes('content')
    );
    if (contentKey) {
      content = data[contentKey];
      console.log('CONTENTë¥¼ ë‹¤ë¥¸ í‚¤ì—ì„œ ì°¾ìŒ:', contentKey, content);
    }
  }
  
  // CONTENTê°€ null, undefined, ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í‘œì‹œ
  if (content !== null && content !== undefined && String(content).trim() !== '') {
    console.log('CONTENT í‘œì‹œ:', content.substring(0, 100) + '...');
    contentBody.innerHTML = content;
  } else {
    console.error('âš ï¸ CONTENTë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ë°ì´í„° í‚¤:', Object.keys(data));
    console.error('âš ï¸ ì „ì²´ ë°ì´í„°:', data);
    contentBody.innerHTML = '<p style="color: #6c757d;">ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
  }

  // íƒœê·¸
  const tagsSection = document.getElementById('postTagsSection');
  const tagList = document.getElementById('tagList');
  if (data.TAGS && data.TAGS.trim()) {
    const tags = data.TAGS.split(',').map(tag => tag.trim()).filter(tag => tag);
    if (tags.length > 0) {
      tagList.innerHTML = '';
      tags.forEach(tag => {
        const tagBadge = document.createElement('span');
        tagBadge.className = 'tag-badge';
        tagBadge.textContent = `#${tag}`;
        tagList.appendChild(tagBadge);
      });
      tagsSection.style.display = 'block';
    } else {
      tagsSection.style.display = 'none';
    }
  } else {
    tagsSection.style.display = 'none';
  }

  // ë¡œë”© ìˆ¨ê¸°ê³  ë‚´ìš© í‘œì‹œ
  loading.style.display = 'none';
  postContent.style.display = 'block';
}

// ì—ëŸ¬ í‘œì‹œ
function showError(message) {
  loading.style.display = 'none';
  error.style.display = 'block';
  error.textContent = message;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
document.addEventListener('DOMContentLoaded', function() {
  loadPost();
  
  // Footer ë¡œë“œ
  fetch('/footer.html')
    .then(res => res.text())
    .then(html => {
      const footer = document.getElementById('site-footer');
      if (footer) {
        footer.innerHTML = html;
      }
    })
    .catch(err => console.error('Footer ë¡œë“œ ì‹¤íŒ¨:', err));
});
</script>
</body>
</html>

