<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://accounts.google.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net;">
  <title>샌드위치냠냠 로그인</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    :root {
      --primary-pink: #ff6b9d;
      --soft-pink: #ffe0e6;
      --soft-gray: #f8f9fa;
      --border-color: #f1f3f5;
      --text-dark: #333;
      --text-muted: #868e96;
    }

    body {
      margin: 0;
      background: linear-gradient(135deg, #fff5f8 0%, #ffe0e6 50%, #fff 100%);
      font-family: 'Pretendard', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: var(--text-dark);
      min-height: 100vh;
    }

    .auth-wrapper {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem 1.5rem;
    }

    .auth-panel {
      width: min(420px, 100%);
      background-color: #fff;
      border-radius: 32px;
      box-shadow: 0 24px 60px rgba(255, 107, 157, 0.18);
      padding: 3.5rem 3rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .auth-title {
      font-size: 1.95rem;
      font-weight: 700;
      color: var(--primary-pink);
      margin: 0;
    }

    .auth-subtitle {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin: 0.75rem 0 0;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .form-group label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .form-group input {
      width: 100%;
      padding: 0.85rem 1rem;
      border-radius: 18px;
      border: 1.5px solid #ffd6e1;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      font-size: 0.95rem;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--primary-pink);
      box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.15);
    }

    .primary-button {
      width: 100%;
      padding: 0.95rem 1rem;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff6b9d, #ff85b8);
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      margin-top: 1rem;
    }

    .primary-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 20px rgba(255, 107, 157, 0.35);
    }

    .outline-button {
      width: 100%;
      padding: 0.95rem 1rem;
      border-radius: 999px;
      border: 1.5px solid rgba(255, 107, 157, 0.45);
      background: #fff;
      color: var(--primary-pink);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: -0.9rem;
    }

    .outline-button:hover {
      background: rgba(255, 107, 157, 0.08);
      border-color: rgba(255, 107, 157, 0.75);
    }

    .notice-area {
      margin-top: 0.5rem;
      padding: 0.85rem 1rem;
      border-radius: 16px;
      background-color: #fff7fa;
      border: 1px solid rgba(255, 107, 157, 0.25);
      color: var(--primary-pink);
      font-size: 0.9rem;
      display: none;
    }

    .notice-area.active {
      display: block;
    }

    .link-group {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .link-group a {
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .link-group a:hover {
      color: var(--primary-pink);
    }

    @media (max-width: 540px) {
      .auth-panel {
        padding: 2.75rem 2.25rem;
      }

      .auth-title {
        font-size: 1.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="auth-wrapper">
    <section class="auth-panel">
      <header>
        <h1 class="auth-title">이메일로 로그인</h1>
        <p class="auth-subtitle">샌드위치냠냠 회원이라면 이메일과 비밀번호로 로그인해 주세요.</p>
      </header>

      <form id="email-login-form" class="auth-form">
        <div class="form-group">
          <label for="login-email">이메일</label>
          <input type="email" id="login-email" name="email" placeholder="example@sandwich.com" required>
        </div>
        <div class="form-group">
          <label for="login-password">비밀번호</label>
          <input type="password" id="login-password" name="password" placeholder="비밀번호를 입력해 주세요" required>
        </div>
        <button type="submit" class="primary-button">로그인</button>
      </form>
      <div id="login-notice" class="notice-area"></div>

      <button id="google-login-button" type="button" class="outline-button">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="" width="20" height="20" aria-hidden="true">
        구글 계정으로 계속하기
      </button>
      <div id="google-notice" class="notice-area"></div>

      <div class="link-group">
        <a href="/home.html">홈으로</a>
        <span>|</span>
        <a href="/find-password.html">비밀번호 찾기</a>
        <span>|</span>
        <a href="/register.html">회원가입</a>
      </div>
    </section>
  </div>

  <script>
    const emailLoginForm = document.getElementById('email-login-form');
    const googleLoginButton = document.getElementById('google-login-button');

    const loginNotice = document.getElementById('login-notice');
    const googleNotice = document.getElementById('google-notice');

    const showNotice = (element, message, type = 'info') => {
      element.textContent = message;
      element.classList.add('active');
      element.style.color = type === 'error' ? '#d6336c' : '#ff6b9d';
    };

    const clearNotice = (element) => {
      element.textContent = '';
      element.classList.remove('active');
    };

    emailLoginForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      clearNotice(loginNotice);

      const formData = new FormData(emailLoginForm);
      const payload = {
        email: formData.get('email'),
        password: formData.get('password')
      };

      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const result = await response.json();

        if (!response.ok || !result.success) {
          showNotice(loginNotice, result.message || '로그인에 실패했습니다.', 'error');
          return;
        }

        showNotice(loginNotice, '로그인에 성공했습니다! 환영합니다 :)');
        emailLoginForm.reset();
        if (result.data) {
          try {
            localStorage.setItem('sandwichUser', JSON.stringify(result.data));
          } catch (error) {
            console.warn('사용자 정보를 저장하지 못했습니다.', error);
          }
        }
        setTimeout(() => {
          window.location.href = '/home.html';
        }, 800);
      } catch (error) {
        console.error(error);
        showNotice(loginNotice, '로그인 처리 중 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.', 'error');
      }
    });

    const simulateGoogleOAuth = async () => {
      // TODO: 실제 Google OAuth 연동으로 교체하세요.
      // 현재는 데모 목적의 모의 데이터를 전송합니다.
      const demoEmail = prompt('구글 계정 이메일을 입력해 주세요.');
      if (!demoEmail) return;

      const mockGoogleId = (window.crypto && typeof window.crypto.randomUUID === 'function')
        ? window.crypto.randomUUID()
        : `google-${Date.now()}`;
      const nickname = demoEmail.split('@')[0];

      try {
        clearNotice(googleNotice);
        const response = await fetch('/api/auth/google', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: demoEmail,
            googleId: mockGoogleId,
            nickname,
            eventOptIn: true
          })
        });
        const result = await response.json();

        if (!response.ok || !result.success) {
          showNotice(googleNotice, result.message || '구글 로그인에 실패했습니다.', 'error');
          return;
        }

        showNotice(googleNotice, result.message || '구글 계정으로 로그인되었습니다!');
        if (result.data) {
          try {
            localStorage.setItem('sandwichUser', JSON.stringify(result.data));
          } catch (error) {
            console.warn('사용자 정보를 저장하지 못했습니다.', error);
          }
        }
        setTimeout(() => {
          window.location.href = '/home.html';
        }, 800);
      } catch (error) {
        console.error(error);
        showNotice(googleNotice, '구글 로그인 처리 중 오류가 발생했습니다.', 'error');
      }
    };

    googleLoginButton.addEventListener('click', simulateGoogleOAuth);
  </script>
</body>
</html>

